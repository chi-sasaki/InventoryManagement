<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.InventoryManagement.repository.PartMapper">

    <!-- 部品の一覧検索 -->
    <select id="findAll" resultType="com.example.InventoryManagement.entity.Part">
        SELECT
        p.id,
        pm.part_name AS partName,
        p.part_master_id AS partMasterId,
        p.process_id,
        p.model_number AS modelNumber,
        p.stock_quantity,
        p.last_ordered_at
        FROM part p
        LEFT JOIN part_master pm
        ON p.part_master_id = pm.id
        ORDER BY p.id
    </select>

    <!-- １件の部品idを取得する-->
    <select id="findById" resultType="com.example.InventoryManagement.entity.Part">
        SELECT
        p.id,
        pm.part_name AS partName,
        p.part_master_id AS partMasterId,
        p.process_id,
        p.model_number,
        p.stock_quantity,
        p.last_ordered_at
        FROM part p
        LEFT JOIN part_master pm
        ON p.part_master_id = pm.id
        WHERE p.id = #{id}
    </select>

    <!-- 指定された工程に紐づく部品情報の一覧を返す -->
    <select id="findByProcessId"
            resultType="com.example.InventoryManagement.entity.Part">
        SELECT
        p.id,
        pm.part_name AS partName,
        p.part_master_id AS partMasterId,
        p.process_id,
        p.model_number,
        p.stock_quantity,
        p.last_ordered_at
        FROM part p
        LEFT JOIN part_master pm
        ON p.part_master_id = pm.id
        WHERE p.process_id = #{processId}
    </select>

    <!-- 指定された部品マスタIDに紐づく部品情報の一覧を取得 -->
    <select id="findByPartMasterId"
            parameterType="long"
            resultType="com.example.InventoryManagement.entity.Part">

        SELECT
        p.id,
        pm.part_name AS partName,
        p.part_master_id AS partMasterId,
        p.process_id,
        p.model_number,
        p.stock_quantity,
        p.last_ordered_at
        FROM part p
        LEFT JOIN part_master pm
        ON p.part_master_id = pm.id
        WHERE p.part_master_id = #{partMasterId}
        ORDER BY p.id

    </select>

    <!-- 部品登録 -->
    <insert id="registerPart"
            parameterType="com.example.InventoryManagement.entity.Part"
            useGeneratedKeys="true"
            keyProperty="id">

        INSERT INTO part
        (part_master_id, process_id, model_number, stock_quantity, last_ordered_at)
        VALUES
        (#{partMasterId}, #{processId}, #{modelNumber}, #{stockQuantity}, #{lastOrderedAt})
    </insert>

    <!-- 部品情報更新 -->
    <update id="updatePart" parameterType="com.example.InventoryManagement.entity.Part">
        UPDATE part
        SET
        part_master_id = #{partMasterId},
        process_id = #{processId},
        model_number = #{modelNumber},
        stock_quantity = #{stockQuantity},
        last_ordered_at = #{lastOrderedAt}
        WHERE id = #{id}
    </update>

    <!-- 部品情報削除 -->
    <delete id="deletePart">
        DELETE FROM part WHERE id = #{id}
    </delete>

</mapper>